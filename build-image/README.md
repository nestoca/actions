# build-image

Builds docker image and pushes it to one of nesto's GCP registries:

- Google Container Registry: gcr.io/nesto-ci-78a3f2e6
- Google Artifacts Registry: northamerica-northeast1-docker.pkg.dev/nesto-ci-78a3f2e6

# Inputs

- `name`: Name of image to build and push.
- `tags`: Tags to put on image.
- `key`: Key for service account to use for pushing images (typically `secrets.GCP_DOCKER_SA_KEY`). Generated by `global` pulumi project, which exposes it and other actions secrets in the `githubActionsSecrets` output
- `context`: (Optional) Context directory to build image from (defaults to `.`).
- `push`: (Optional) Should the image be published? If false, the image will only be built and not published. (default: false)

The below option should only be set if instructed by DevOps. Leave them unset otherwise.
- `repository`: (Optional) The Google Artifact Registry repo to push the image to. If unset, image will be pushed to Google Container Registry. 

# Outputs

No outputs.

# Example

```yaml
jobs:
  job:
    name: Build image
    runs-on: ubuntu-latest

    steps:
      - name: Check out
        uses: actions/checkout@v3

      - name: Get build info
        id: info
        uses: nestoca/actions/get-build-info@v1

      - name: Build image
        uses: nestoca/actions/build-image@v1
        with:
          push: "false" # default
          name: ${{ steps.info.outputs.project }}
          tags: ${{ steps.info.outputs.docker-tag }},latest
          key: ${{ secrets.GCP_DOCKER_SA_KEY }}
```
